name: Backend Tests
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_call:
    
jobs:
  unit-tests:
    name: Unit Tests # Premier job : ExÃ©cute toujours les tests unitaires
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
      
      - name: ğŸ Setup Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
          
      - name: ğŸ“¦ Install UV
        run: pip install uv
        
      - name: ğŸ“š Install dependencies
        run: |
          cd backend
          uv sync
          
      - name: ğŸ§ª Run unit tests only
        # Exclut les tests marquÃ©s comme 'e2e' [cite: 445]
        run: |
          cd backend
          uv run pytest -v -m "not e2e"
          
  e2e-tests:
    name: E2E Tests # DeuxiÃ¨me job : ExÃ©cute les tests E2E
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main' # âœ¨ Conditionnel : Seulement sur la branche main [cite: 449, 473]
    needs: unit-tests # DÃ©pendance : Attend que les tests unitaires aient rÃ©ussi [cite: 450, 474]
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
        
      - name: ğŸ Setup Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
          
      - name: ğŸ“¦ Install UV
        run: pip install uv
        
      - name: ğŸ“š Install dependencies
        run: |
          cd backend
          uv sync
          
      - name: ğŸ§ª Run E2E tests only
        # ExÃ©cute uniquement les tests marquÃ©s comme 'e2e' [cite: 470]
        run: |
          cd backend
          uv run pytest -v -m "e2e"